<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - WIMT Result Management</title>
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            color: #333;
            line-height: 1.6;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        a {
            text-decoration: none;
            color: inherit;
        }
        
        /* Header Styles from index.html */
        .header-top {
            background-color: #1a237e;
            color: white;
            padding: 8px 0;
            font-size: 14px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            width: 100%;
        }
        
        .header-top .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .contact-info {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .contact-info span {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .social-icons a {
            margin-left: 10px;
            color: white;
            display: inline-block;
        }
        
        /* Main Header from index.html */
        .main-header {
            background-color: white;
            padding: 15px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .main-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo {
            display: flex;
            align-items: center;
            max-width: 60%;
        }
        
        .logo-img {
            background: url("images/wmit logo.png") center/contain no-repeat;
            width: 80px;
            height: 80px;
            min-width: 80px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            border-radius: 5px;
        }
        
        .logo-text h1 {
            font-size: 20px;
            color: #1a237e;
            line-height: 1.2;
        }
        
        .logo-text p {
            font-size: 12px;
            color: #666;
        }
        
        /* Header Actions */
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        /* Admin Specific Styles */
        .admin-container {
            margin: 40px auto;
            padding: 0 20px;
        }
        
        .admin-header {
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
            color: white;
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(26, 35, 126, 0.2);
        }
        
        .admin-header h1 {
            margin: 0;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .admin-header p {
            opacity: 0.9;
            margin: 10px 0 0;
            font-size: 15px;
        }
        
        .admin-grid {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 25px;
        }
        
        .admin-sidebar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            height: fit-content;
            position: sticky;
            top: 120px;
            overflow-y: auto;
            max-height: calc(100vh - 160px);
        }
        
        .admin-nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .admin-nav li {
            margin-bottom: 8px;
        }
        
        .admin-nav a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: #f8f9fa;
            border-radius: 8px;
            color: #333;
            text-decoration: none;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 14px;
        }
        
        .admin-nav a:hover,
        .admin-nav a.active {
            background: #1a237e;
            color: white;
            transform: translateX(5px);
        }
        
        .admin-content {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            min-height: 600px;
            overflow-x: auto;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e8eaf6;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .section-header h2 {
            color: #1a237e;
            margin: 0;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 35, 126, 0.2);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #ef5350 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #00bcd4 0%, #26c6da 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        /* Form Styles */
        .admin-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #444;
            font-size: 14px;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            background: white;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #1a237e;
            box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
        }
        
        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%231a237e' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }
        
        /* Profile Picture Upload Section */
        .profile-upload-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px dashed #ddd;
        }
        
        .profile-preview-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .profile-preview {
            width: 140px;
            height: 140px;
            border-radius: 12px;
            overflow: hidden;
            border: 4px solid white;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            position: relative;
        }
        
        .profile-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-preview-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
        }
        
        .upload-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .url-input-group {
            display: flex;
            gap: 8px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .url-input-group input {
            flex: 1;
            min-width: 0;
        }
        
        /* Table Styles with Profile Pictures */
        .results-table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            margin-top: 20px;
            -webkit-overflow-scrolling: touch;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }
        
        .results-table th {
            background: #1a237e;
            color: white;
            padding: 14px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            position: sticky;
            top: 0;
        }
        
        .results-table td {
            padding: 14px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 13px;
            vertical-align: middle;
        }
        
        .results-table tr:hover {
            background: #f8f9fa;
        }
        
        .student-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .student-avatar {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .student-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .student-avatar-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: bold;
        }
        
        .student-info {
            display: flex;
            flex-direction: column;
            min-width: 0;
        }
        
        .student-name {
            font-weight: 600;
            color: #1a237e;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .student-enrollment {
            font-size: 11px;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
            min-width: 70px;
        }
        
        /* Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
            border-top: 4px solid #1a237e;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
        }
        
        .stat-card h3 {
            margin: 0 0 8px;
            color: #1a237e;
            font-size: 28px;
            font-weight: 700;
        }
        
        .stat-card p {
            margin: 0;
            color: #666;
            font-size: 13px;
            font-weight: 500;
        }
        
        .stat-icon {
            font-size: 22px;
            margin-bottom: 12px;
            color: #1a237e;
        }
        
        /* Search Bar */
        .search-box {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .search-box input {
            flex: 1;
            min-width: 200px;
            padding: 10px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #1a237e;
        }
        
        /* Status Indicators */
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
            white-space: nowrap;
        }
        
        .status-active {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-inactive {
            background: #ffebee;
            color: #c62828;
        }
        
        .grade-a { background: #e8f5e9; color: #2e7d32; }
        .grade-b { background: #e3f2fd; color: #1565c0; }
        .grade-c { background: #fff3e0; color: #ef6c00; }
        .grade-d { background: #ffebee; color: #c62828; }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e8eaf6;
        }
        
        .modal-header h3 {
            color: #1a237e;
            margin: 0;
            font-size: 20px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 5px;
            line-height: 1;
        }
        
        .modal-close:hover {
            color: #f44336;
        }
        
        /* Profile Picture Modal */
        .profile-modal-content {
            max-width: 500px;
        }
        
        .profile-upload-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .upload-option {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-option:hover {
            border-color: #1a237e;
            background: #f8f9fa;
        }
        
        .upload-option i {
            font-size: 32px;
            color: #1a237e;
            margin-bottom: 10px;
        }
        
        .upload-option p {
            margin: 0;
            font-size: 13px;
            color: #666;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .page-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
        }
        
        .page-btn:hover:not(:disabled) {
            background: #f5f5f5;
        }
        
        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .page-btn.active {
            background: #1a237e;
            color: white;
            border-color: #1a237e;
        }
        
        /* Messages */
        .message {
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
            display: none;
        }
        
        .message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
            display: block;
        }
        
        .message.error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
            display: block;
        }
        
        /* Offline Mode */
        .offline-mode {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
        }
        
        /* Footer from index.html */
        .footer {
            background-color: #1a237e;
            color: white;
            padding: 50px 0 20px;
            margin-top: 60px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .footer-column h3 {
            font-size: 16px;
            margin-bottom: 15px;
            position: relative;
            padding-bottom: 8px;
        }
        
        .footer-column h3:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 2px;
            background-color: #e53935;
        }
        
        .footer-column p {
            margin-bottom: 10px;
            font-size: 13px;
            opacity: 0.8;
            line-height: 1.5;
        }
        
        .footer-column a {
            display: block;
            margin-bottom: 8px;
            font-size: 13px;
            opacity: 0.8;
            transition: opacity 0.3s;
            cursor: pointer;
        }
        
        .footer-column a:hover {
            opacity: 1;
        }
        
        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 12px;
            opacity: 0.7;
        }
        
        /* Responsive Styles */
        
        /* Tablet View */
        @media (max-width: 992px) {
            .admin-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .admin-sidebar {
                position: static;
                max-height: none;
                top: 0;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .profile-upload-options {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .results-table {
                min-width: 800px;
            }
        }
        
        /* Mobile View */
        @media (max-width: 768px) {
            .header-top .container {
                flex-direction: column;
                text-align: center;
                gap: 8px;
            }
            
            .contact-info {
                justify-content: center;
                gap: 10px;
            }
            
            .logo {
                max-width: 100%;
                margin-bottom: 10px;
                justify-content: center;
                text-align: center;
            }
            
            .logo-text h1 {
                font-size: 18px;
            }
            
            .logo-img {
                width: 50px;
                height: 50px;
                min-width: 50px;
                font-size: 16px;
                margin-right: 10px;
            }
            
            .admin-header {
                padding: 20px;
            }
            
            .admin-header h1 {
                font-size: 22px;
            }
            
            .admin-header p {
                font-size: 14px;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .section-header h2 {
                font-size: 20px;
            }
            
            .search-box {
                width: 100%;
            }
            
            .search-box input {
                min-width: 100%;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn-sm {
                min-width: auto;
                width: 100%;
                justify-content: center;
            }
            
            .upload-controls {
                flex-direction: column;
                width: 100%;
            }
            
            .url-input-group {
                flex-direction: column;
            }
            
            .profile-upload-options {
                grid-template-columns: 1fr;
            }
        }
        
        /* Small Mobile View */
        @media (max-width: 576px) {
            .container {
                padding: 0 15px;
            }
            
            .admin-container {
                padding: 0 15px;
                margin: 20px auto;
            }
            
            .admin-header {
                padding: 15px;
            }
            
            .admin-header h1 {
                font-size: 20px;
                gap: 10px;
            }
            
            .admin-content {
                padding: 15px;
            }
            
            .admin-form {
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .profile-preview {
                width: 120px;
                height: 120px;
            }
            
            .modal-content {
                padding: 15px;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
                gap: 25px;
            }
            
            .header-actions {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* Extra Small Mobile View */
        @media (max-width: 400px) {
            .logo-text h1 {
                font-size: 16px;
            }
            
            .admin-nav a {
                padding: 12px;
                font-size: 13px;
            }
            
            .btn {
                padding: 8px 15px;
                font-size: 13px;
            }
            
            .form-control {
                padding: 8px 10px;
            }
            
            .results-table th,
            .results-table td {
                padding: 10px;
            }
        }
        
        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            .admin-sidebar,
            .admin-content,
            .stat-card,
            .admin-form,
            .profile-upload-section,
            .modal-content {
                background: #1e1e1e;
                color: #e0e0e0;
            }
            
            .form-control {
                background: #2d2d2d;
                border-color: #444;
                color: #e0e0e0;
            }
            
            .student-name {
                color: #bb86fc;
            }
            
            .results-table tr:hover {
                background: #2d2d2d;
            }
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- Header Top from index.html -->
    <div class="header-top">
        <div class="container">
            <div class="contact-info">
                <span><i class="fas fa-phone"></i> +91 9958430389</span>
                <span><i class="fas fa-envelope"></i> info@wimt.org</span>
            </div>
            <div class="social-icons">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-linkedin-in"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
    </div>

    <!-- Main Header from index.html -->
    <header class="main-header">
        <div class="container">
            <div class="logo">
                <div class="logo-img"></div>
                <div class="logo-text">
                    <h1>Wintech Institute of Management & Technology</h1>
                    <p>Admin Panel - Result Management System</p>
                </div>
            </div>
            <div class="header-actions">
                <a href="result.html" class="btn btn-primary">
                    <i class="fas fa-arrow-left"></i> Back to Results
                </a>
                <a href="index.html" class="btn btn-secondary">
                    <i class="fas fa-home"></i> Home
                </a>
            </div>
        </div>
    </header>

    <!-- Admin Panel -->
    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-cogs"></i> Result Management System</h1>
            <p>Manage student results, profile pictures, and system settings</p>
        </div>
        
        <div class="admin-grid">
            <!-- Sidebar Navigation -->
            <div class="admin-sidebar">
                <ul class="admin-nav">
                    <li><a href="#" class="active" onclick="showSection('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="#" onclick="showSection('addResult')"><i class="fas fa-plus-circle"></i> Add New Result</a></li>
                    <li><a href="#" onclick="showSection('viewResults')"><i class="fas fa-list"></i> View All Results</a></li>
                    <li><a href="#" onclick="showSection('editResults')"><i class="fas fa-edit"></i> Edit Results</a></li>
                    <li><a href="#" onclick="showSection('profilePictures')"><i class="fas fa-images"></i> Profile Pictures</a></li>
                    <li><a href="#" onclick="showSection('searchResults')"><i class="fas fa-search"></i> Search Results</a></li>
                    <li><a href="#" onclick="showSection('statistics')"><i class="fas fa-chart-bar"></i> Statistics</a></li>
                    <li><a href="#" onclick="showSection('bulkUpload')"><i class="fas fa-upload"></i> Bulk Upload</a></li>
                    <li><a href="#" onclick="showSection('settings')"><i class="fas fa-cog"></i> Settings</a></li>
                </ul>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                    <div style="color: #666; font-size: 12px; margin-bottom: 10px;">Database Status</div>
                    <div id="dbStatus" style="display: flex; align-items: center; gap: 8px; color: #4caf50;">
                        <i class="fas fa-circle" style="font-size: 10px;"></i>
                        <span>Connecting to Firestore...</span>
                    </div>
                    <div id="recordCount" style="font-size: 12px; color: #666; margin-top: 5px;">Initializing...</div>
                </div>
            </div>
            
            <!-- Main Content Area -->
            <div class="admin-content">
                <!-- Messages Container -->
                <div id="messageContainer"></div>
                
                <!-- Offline Mode Warning -->
                <div id="offlineWarning" class="offline-mode" style="display: none;">
                    <strong><i class="fas fa-exclamation-triangle"></i> Offline Mode</strong>
                    <p style="margin: 5px 0 0;">You are currently in offline mode. Some features may be limited.</p>
                </div>
                
                <!-- Dashboard Section -->
                <div id="dashboardSection" class="content-section active">
                    <div class="section-header">
                        <h2><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h2>
                        <button class="btn btn-primary" onclick="refreshDashboard()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-graduation-cap"></i></div>
                            <h3 id="totalResults">0</h3>
                            <p>Total Results</p>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-image"></i></div>
                            <h3 id="withPhotos">0</h3>
                            <p>With Profile Photos</p>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-medal"></i></div>
                            <h3 id="gradeA">0</h3>
                            <p>Grade A Students</p>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
                            <h3 id="recentAdded">0</h3>
                            <p>Added This Month</p>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 25px;">
                        <h3 style="color: #1a237e; margin-bottom: 12px;">Quick Actions</h3>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="showSection('addResult')">
                                <i class="fas fa-plus"></i> Add Result
                            </button>
                            <button class="btn btn-success" onclick="exportToCSV()">
                                <i class="fas fa-download"></i> Export CSV
                            </button>
                            <button class="btn btn-warning" onclick="showSection('profilePictures')">
                                <i class="fas fa-images"></i> Manage Photos
                            </button>
                            <button class="btn btn-info" onclick="showSection('statistics')">
                                <i class="fas fa-chart-pie"></i> Analytics
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3 style="color: #1a237e; margin-bottom: 12px;">Recent Students with Photos</h3>
                        <div id="recentWithPhotos" style="background: white; border-radius: 10px; padding: 15px; border: 1px solid #e0e0e0; min-height: 150px;">
                            <div style="text-align: center; color: #666; padding: 30px;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 20px; margin-bottom: 10px;"></i>
                                <p>Loading recent students...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Add New Result Section -->
                <div id="addResultSection" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-plus-circle"></i> Add New Student Result</h2>
                        <button class="btn btn-primary" onclick="addNewResult()">
                            <i class="fas fa-save"></i> Save Result
                        </button>
                    </div>
                    
                    <div class="admin-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Student Name *</label>
                                <input type="text" id="addStudentName" class="form-control" placeholder="Full name in capital letters">
                            </div>
                            
                            <div class="form-group">
                                <label>Enrollment Number *</label>
                                <input type="text" id="addEnrollment" class="form-control" placeholder="WIMT2124BTCE00799">
                            </div>
                            
                            <div class="form-group">
                                <label>Course *</label>
                                <input type="text" id="addCourse" class="form-control" placeholder="BACHELOR OF TECHNOLOGY IN CIVIL ENGINEERING">
                            </div>
                            
                            <div class="form-group">
                                <label>Year of Passing *</label>
                                <input type="text" id="addYear" class="form-control" placeholder="JULY 2021 - JUNE 2024">
                            </div>
                            
                            <div class="form-group">
                                <label>Final Grade *</label>
                                <select id="addGrade" class="form-control">
                                    <option value="A">A (≥ 60%)</option>
                                    <option value="B">B (≥ 50%)</option>
                                    <option value="C">C (≥ 40%)</option>
                                    <option value="D">D (Failure)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Percentage Score</label>
                                <input type="number" id="addPercentage" class="form-control" placeholder="75" min="0" max="100" step="0.01">
                            </div>
                        </div>
                        
                        <!-- Profile Picture Upload Section -->
                        <div class="profile-upload-section">
                            <h3 style="color: #1a237e; margin-bottom: 15px;"><i class="fas fa-image"></i> Profile Picture (Optional)</h3>
                            
                            <div class="profile-preview-container">
                                <div class="profile-preview">
                                    <img id="addProfilePreview" src="" alt="Profile Preview" style="display: none;">
                                    <div id="addProfilePlaceholder" class="profile-preview-placeholder">
                                        <i class="fas fa-user-graduate"></i>
                                    </div>
                                </div>
                                
                                <div class="upload-controls">
                                    <button type="button" class="btn btn-primary" onclick="openProfileModal('add')">
                                        <i class="fas fa-upload"></i> Upload Picture
                                    </button>
                                    <button type="button" class="btn btn-secondary" onclick="clearProfilePicture('add')">
                                        <i class="fas fa-times"></i> Clear
                                    </button>
                                </div>
                                
                                <div class="url-input-group">
                                    <input type="text" id="addProfileUrl" class="form-control" placeholder="Or enter image URL directly...">
                                    <button type="button" class="btn btn-info" onclick="loadFromUrl('add')">
                                        <i class="fas fa-link"></i> Load URL
                                    </button>
                                </div>
                            </div>
                            
                            <div id="profileUrlHelp" style="font-size: 12px; color: #666; text-align: center; margin-top: 10px;">
                                Supported formats: JPG, PNG, GIF. Max size: 2MB. Use square images for best results.
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Remarks (Optional)</label>
                                <input type="text" id="addRemarks" class="form-control" placeholder="Any additional remarks">
                            </div>
                            
                            <div class="form-group">
                                <label>Status</label>
                                <select id="addStatus" class="form-control">
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="addResultMessage" class="message"></div>
                    </div>
                    
                    <div style="background: #fff8e1; padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #ffb300;">
                        <h4 style="color: #ff8f00; margin-bottom: 8px;"><i class="fas fa-lightbulb"></i> Quick Fill Example</h4>
                        <p style="color: #666; font-size: 13px; margin-bottom: 10px;">Click below to fill sample data for testing:</p>
                        <button class="btn btn-sm" onclick="fillSampleData()" style="background: #ffb300; color: white;">
                            <i class="fas fa-magic"></i> Fill Sample Data
                        </button>
                    </div>
                </div>
                
                <!-- View All Results Section -->
                <div id="viewResultsSection" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-list"></i> All Student Results</h2>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <div class="search-box">
                                <input type="text" id="searchResults" class="form-control" placeholder="Search by name, enrollment, or course...">
                                <button class="btn btn-primary" onclick="searchResults()">
                                    <i class="fas fa-search"></i> Search
                                </button>
                            </div>
                            <button class="btn btn-secondary" onclick="loadAllResults()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="results-table-container">
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th style="width: 180px;">Student</th>
                                    <th style="width: 150px;">Course</th>
                                    <th style="width: 120px;">Year</th>
                                    <th style="width: 80px;">Grade</th>
                                    <th style="width: 100px;">Status</th>
                                    <th style="width: 120px;">Photo</th>
                                    <th style="width: 200px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="resultsTableBody">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 40px;">
                                        <div style="color: #666;">
                                            <i class="fas fa-spinner fa-spin" style="font-size: 20px; margin-bottom: 10px;"></i>
                                            <p>Loading results...</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="pagination">
                        <button class="page-btn" onclick="prevPage()" id="prevBtn" disabled>
                            <i class="fas fa-chevron-left"></i> Prev
                        </button>
                        <div id="pageInfo" style="padding: 0 12px; font-size: 13px;">Page 1 of 1</div>
                        <button class="page-btn" onclick="nextPage()" id="nextBtn" disabled>
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; flex-wrap: wrap; gap: 10px;">
                        <div id="tableInfo" style="color: #666; font-size: 13px;">Showing 0 results</div>
                        <div>
                            <button class="btn btn-sm btn-danger" onclick="deleteSelected()" id="deleteSelectedBtn" style="display: none;">
                                <i class="fas fa-trash"></i> Delete Selected
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Profile Pictures Management Section -->
                <div id="profilePicturesSection" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-images"></i> Profile Pictures Management</h2>
                        <button class="btn btn-primary" onclick="openBulkPhotoUpload()">
                            <i class="fas fa-upload"></i> Bulk Upload
                        </button>
                    </div>
                    
                    <div class="admin-form">
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                            <h4 style="color: #1565c0; margin-bottom: 8px;"><i class="fas fa-info-circle"></i> Instructions</h4>
                            <p style="color: #666; font-size: 13px; margin-bottom: 8px;">
                                1. Select a student from the list below<br>
                                2. Upload or enter URL for profile picture<br>
                                3. Click "Update Picture" to save<br>
                                4. Use "Bulk Upload" for multiple students
                            </p>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Select Student *</label>
                                <select id="selectStudent" class="form-control" onchange="loadStudentForPhotoUpdate()">
                                    <option value="">-- Select a student --</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Current Enrollment</label>
                                <input type="text" id="currentEnrollment" class="form-control" readonly>
                            </div>
                        </div>
                        
                        <!-- Selected Student Preview -->
                        <div id="selectedStudentPreview" style="display: none; margin: 20px 0;">
                            <h4 style="color: #1a237e; margin-bottom: 12px;">Selected Student</h4>
                            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px; flex-wrap: wrap;">
                                <div class="profile-preview" style="width: 80px; height: 80px;">
                                    <img id="selectedStudentPhoto" src="" alt="Student Photo" style="display: none;">
                                    <div id="selectedStudentPlaceholder" class="profile-preview-placeholder">
                                        <i class="fas fa-user"></i>
                                    </div>
                                </div>
                                <div>
                                    <h5 id="selectedStudentName" style="color: #1a237e; margin-bottom: 5px;">-</h5>
                                    <p id="selectedStudentDetails" style="color: #666; font-size: 13px; margin: 0;">-</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Photo Upload for Selected Student -->
                        <div id="photoUpdateSection" style="display: none;">
                            <div class="profile-upload-section">
                                <h4 style="color: #1a237e; margin-bottom: 15px;">Update Profile Picture</h4>
                                
                                <div class="profile-preview-container">
                                    <div class="profile-preview">
                                        <img id="updateProfilePreview" src="" alt="Profile Preview" style="display: none;">
                                        <div id="updateProfilePlaceholder" class="profile-preview-placeholder">
                                            <i class="fas fa-user-graduate"></i>
                                        </div>
                                    </div>
                                    
                                    <div class="upload-controls">
                                        <button type="button" class="btn btn-primary" onclick="openProfileModal('update')">
                                            <i class="fas fa-upload"></i> Upload Picture
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="clearProfilePicture('update')">
                                            <i class="fas fa-times"></i> Clear
                                        </button>
                                    </div>
                                    
                                    <div class="url-input-group">
                                        <input type="text" id="updateProfileUrl" class="form-control" placeholder="Or enter image URL directly...">
                                        <button type="button" class="btn btn-info" onclick="loadFromUrl('update')">
                                            <i class="fas fa-link"></i> Load URL
                                        </button>
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap;">
                                    <button class="btn btn-success" onclick="updateStudentPhoto()">
                                        <i class="fas fa-save"></i> Update Picture
                                    </button>
                                    <button class="btn btn-warning" onclick="removeStudentPhoto()">
                                        <i class="fas fa-trash-alt"></i> Remove Picture
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="photoUpdateMessage" class="message" style="margin-top: 15px;"></div>
                    </div>
                    
                    <!-- Students without Photos -->
                    <div style="margin-top: 30px;">
                        <h3 style="color: #1a237e; margin-bottom: 15px;"><i class="fas fa-user-times"></i> Students Without Profile Pictures</h3>
                        <div id="studentsWithoutPhotos" style="background: #f8f9fa; border-radius: 10px; padding: 15px; min-height: 100px;">
                            <div style="text-align: center; color: #666; padding: 30px;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 20px; margin-bottom: 10px;"></i>
                                <p>Loading students without photos...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Edit Results Section -->
                <div id="editResultsSection" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-edit"></i> Edit Results</h2>
                        <div style="color: #666; font-size: 13px;">
                            Click on any result in the table to edit it (including profile picture)
                        </div>
                    </div>
                    
                    <div id="editResultsContainer">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-edit" style="font-size: 36px; margin-bottom: 15px; color: #e0e0e0;"></i>
                            <h3 style="color: #666; margin-bottom: 10px;">No Result Selected</h3>
                            <p>Go to "View All Results" section and click the edit button on any result to edit it here.</p>
                            <button class="btn btn-primary" onclick="showSection('viewResults')" style="margin-top: 15px;">
                                <i class="fas fa-list"></i> View All Results
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Search Results Section -->
                <div id="searchResultsSection" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-search"></i> Advanced Search</h2>
                        <button class="btn btn-primary" onclick="advancedSearch()">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                    
                    <div class="admin-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Student Name</label>
                                <input type="text" id="searchName" class="form-control" placeholder="Enter student name">
                            </div>
                            
                            <div class="form-group">
                                <label>Enrollment Number</label>
                                <input type="text" id="searchEnrollment" class="form-control" placeholder="Enter enrollment number">
                            </div>
                            
                            <div class="form-group">
                                <label>Course</label>
                                <input type="text" id="searchCourse" class="form-control" placeholder="Enter course name">
                            </div>
                            
                            <div class="form-group">
                                <label>Year of Passing</label>
                                <input type="text" id="searchYear" class="form-control" placeholder="e.g., 2024">
                            </div>
                            
                            <div class="form-group">
                                <label>Grade</label>
                                <select id="searchGrade" class="form-control">
                                    <option value="">All Grades</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Has Profile Picture</label>
                                <select id="searchHasPhoto" class="form-control">
                                    <option value="">All</option>
                                    <option value="yes">With Photo</option>
                                    <option value="no">Without Photo</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="searchResultsContainer" style="margin-top: 25px;"></div>
                    </div>
                </div>
                
                <!-- Statistics Section -->
                <div id="statisticsSection" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-chart-bar"></i> Statistics & Analytics</h2>
                        <button class="btn btn-primary" onclick="loadStatistics()">
                            <i class="fas fa-sync-alt"></i> Refresh Stats
                        </button>
                    </div>
                    
                    <div id="statisticsContent">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-chart-pie" style="font-size: 36px; margin-bottom: 15px; color: #e0e0e0;"></i>
                            <h3 style="color: #666; margin-bottom: 10px;">Statistics Loading</h3>
                            <p>Loading detailed statistics and analytics...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Bulk Upload Section -->
                <div id="bulkUploadSection" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-upload"></i> Bulk Upload Results</h2>
                        <button class="btn btn-primary" onclick="processBulkUpload()">
                            <i class="fas fa-upload"></i> Upload CSV
                        </button>
                    </div>
                    
                    <div id="bulkUploadContent">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-file-upload" style="font-size: 36px; margin-bottom: 15px; color: #e0e0e0;"></i>
                            <h3 style="color: #666; margin-bottom: 10px;">Bulk Upload</h3>
                            <p>Upload multiple results via CSV file</p>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Section -->
                <div id="settingsSection" class="content-section">
                    <div class="section-header">
                        <h2><i class="fas fa-cog"></i> System Settings</h2>
                        <button class="btn btn-primary" onclick="saveSettings()">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </div>
                    
                    <div id="settingsContent">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <i class="fas fa-cogs" style="font-size: 36px; margin-bottom: 15px; color: #e0e0e0;"></i>
                            <h3 style="color: #666; margin-bottom: 10px;">Settings</h3>
                            <p>Configure system preferences and options</p>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <!-- Profile Picture Upload Modal -->
    <div class="modal" id="profileModal">
        <div class="modal-content profile-modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-image"></i> Upload Profile Picture</h3>
                <button class="modal-close" onclick="closeProfileModal()">&times;</button>
            </div>
            <div id="profileModalContent">
                <div class="profile-upload-options">
                    <div class="upload-option" onclick="selectUploadMethod('url')">
                        <i class="fas fa-link"></i>
                        <h4>Image URL</h4>
                        <p>Use an existing image URL from the web</p>
                    </div>
                    <div class="upload-option" onclick="selectUploadMethod('file')">
                        <i class="fas fa-file-upload"></i>
                        <h4>Upload File</h4>
                        <p>Upload an image from your computer</p>
                    </div>
                </div>
                
                <!-- URL Input -->
                <div id="urlUploadSection" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label>Image URL</label>
                        <input type="text" id="modalImageUrl" class="form-control" placeholder="https://example.com/photo.jpg">
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 15px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="loadImageFromUrl()">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                        <button class="btn btn-success" onclick="saveImageFromUrl()">
                            <i class="fas fa-check"></i> Use This Image
                        </button>
                    </div>
                </div>
                
                <!-- File Upload -->
                <div id="fileUploadSection" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label>Choose Image File</label>
                        <input type="file" id="modalImageFile" class="form-control" accept="image/*">
                    </div>
                    <div id="filePreview" style="margin: 15px 0; text-align: center; display: none;">
                        <img id="filePreviewImage" src="" alt="Preview" style="max-width: 180px; max-height: 180px; border-radius: 8px;">
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 15px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="previewImageFile()">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                        <button class="btn btn-success" onclick="saveImageFromFile()">
                            <i class="fas fa-check"></i> Use This Image
                        </button>
                    </div>
                </div>
                
                <!-- Preview Section -->
                <div id="imagePreviewSection" style="display: none; margin-top: 20px; text-align: center;">
                    <h4 style="color: #1a237e; margin-bottom: 12px;">Image Preview</h4>
                    <div style="width: 180px; height: 180px; margin: 0 auto 15px; border-radius: 12px; overflow: hidden;">
                        <img id="finalPreviewImage" src="" alt="Final Preview" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <button class="btn btn-success" onclick="confirmImageSelection()" style="width: 100%;">
                        <i class="fas fa-check-circle"></i> Confirm Selection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Student Result</h3>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <div id="editModalContent">
                <!-- Dynamic content loaded here -->
            </div>
        </div>
    </div>

    <!-- Footer from index.html -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>WIMT Institute</h3>
                    <p>Wintech Institute of Management & Technology (WIMT) is committed to delivering high-quality education through innovative learning techniques and industry-relevant programs.</p>
                    <div style="margin-top: 15px;">
                        <a href="#"><i class="fab fa-facebook-f"></i> Facebook</a>
                        <a href="#"><i class="fab fa-twitter"></i> Twitter</a>
                        <a href="#"><i class="fab fa-linkedin-in"></i> LinkedIn</a>
                        <a href="#"><i class="fab fa-instagram"></i> Instagram</a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <a href="index.html">Home</a>
                    <a href="index.html#about">About Us</a>
                    <a href="index.html#courses">Courses</a>
                    <a href="result.html">Result Verification</a>
                    <a href="admin.html" class="active">Admin Panel</a>
                    <a href="#">Privacy Policy</a>
                </div>
                <div class="footer-column">
                    <h3>Contact Info</h3>
                    <p><i class="fas fa-map-marker-alt"></i> WZ-1, Central Market Budela, Vikaspuri, New Delhi - 110018</p>
                    <p><i class="fas fa-phone"></i> +91 9958430389</p>
                    <p><i class="fas fa-envelope"></i> Info@wimt.org</p>
                    <p><i class="fas fa-globe"></i> www.wimt.org</p>
                </div>
                <div class="footer-column">
                    <h3>Approvals</h3>
                    <p>U.G.C Approved Universities</p>
                    <p>NCT Approved Institute</p>
                    <p>Various Certified Courses</p>
                    <p>Industry Recognized Programs</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© Copyright 1990 Wintech Institute of Management & Technology. All Rights Reserved.</p>
                <p>Designed for Your Success. | Development by DigiSe</p>
            </div>
        </div>
    </footer>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        const firebaseConfig = {
            apiKey: "AIzaSyBBvKKGZQB_OZI9H8KVxyX0OfAePP2OEgs",
            authDomain: "student-25531.firebaseapp.com",
            projectId: "student-25531",
            storageBucket: "student-25531.appspot.com",
            messagingSenderId: "159478186132",
            appId: "1:159478186132:web:8f25f7756e64a1eafff481"
        };

        // Initialize Firebase
        let app;
        let db;
        let isFirebaseInitialized = false;
        let isOnline = navigator.onLine;

        // ==================== GLOBAL VARIABLES ====================
        let currentPage = 1;
        let resultsPerPage = 15; // Reduced for mobile
        let totalResults = 0;
        let allResults = [];
        let filteredResults = [];
        let selectedResults = new Set();
        let currentEditId = null;
        let currentModalType = 'add';
        let selectedStudentId = null;
        let currentSelectedImage = null;
        let allStudents = [];
        let offlineMode = false;

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', async function() {
            // Check internet connection
            updateConnectionStatus();
            
            // Start initialization
            await initializeFirebase();
            
            // Initialize admin panel
            if (isFirebaseInitialized) {
                initializeAdmin();
            } else {
                // Load in offline mode
                loadOfflineData();
                showOfflineModeWarning();
            }
            
            // Monitor connection changes
            window.addEventListener('online', handleConnectionChange);
            window.addEventListener('offline', handleConnectionChange);
            
            // Handle window resize
            window.addEventListener('resize', handleResize);
            
            // Initialize responsive settings
            handleResize();
        });

        // ==================== RESPONSIVE HANDLING ====================
        function handleResize() {
            const width = window.innerWidth;
            
            // Adjust results per page based on screen size
            if (width < 576) {
                resultsPerPage = 8;
            } else if (width < 768) {
                resultsPerPage = 10;
            } else if (width < 992) {
                resultsPerPage = 12;
            } else {
                resultsPerPage = 15;
            }
            
            // Re-display results if already loaded
            if (allResults.length > 0) {
                displayResultsPage();
                updateTableInfo();
            }
        }

        // ==================== FIREBASE INITIALIZATION ====================
        async function initializeFirebase() {
            try {
                console.log('Initializing Firebase...');
                
                // Update status
                updateDBStatus('Connecting to Firestore...', '#ff9800');
                
                // Check if Firebase app is already initialized
                if (!firebase.apps.length) {
                    app = firebase.initializeApp(firebaseConfig);
                } else {
                    app = firebase.app();
                }
                
                // Initialize Firestore
                db = firebase.firestore();
                
                // Try to enable offline persistence
                try {
                    await db.enablePersistence();
                    console.log('Offline persistence enabled');
                } catch (persistenceError) {
                    console.warn('Offline persistence not supported:', persistenceError);
                }
                
                // Test connection
                await db.collection('wimt').limit(1).get();
                
                // If we get here, connection is successful
                isFirebaseInitialized = true;
                updateDBStatus('Connected to Firestore', '#4caf50');
                
                console.log('Firebase initialized successfully');
                return true;
                
            } catch (error) {
                console.error('Firebase initialization failed:', error);
                
                let errorMessage = error.message;
                
                if (error.code === 'failed-precondition') {
                    errorMessage = 'Multiple tabs open. Close other tabs and refresh.';
                } else if (error.code === 'unavailable') {
                    errorMessage = 'Network unavailable. Please check your internet connection.';
                }
                
                updateDBStatus(`Connection Error: ${errorMessage}`, '#f44336');
                isFirebaseInitialized = false;
                
                return false;
            }
        }

        // ==================== CONNECTION HANDLING ====================
        function updateConnectionStatus() {
            isOnline = navigator.onLine;
        }

        function handleConnectionChange() {
            updateConnectionStatus();
            
            if (isOnline && !isFirebaseInitialized) {
                // Try to reconnect
                showMessage('Reconnecting to database...', 'success');
                setTimeout(async () => {
                    if (await initializeFirebase()) {
                        initializeAdmin();
                        showMessage('Reconnected successfully!', 'success');
                    }
                }, 1000);
            } else if (!isOnline) {
                showOfflineModeWarning();
            }
        }

        function updateDBStatus(message, color = '#4caf50') {
            const statusElement = document.getElementById('dbStatus');
            statusElement.innerHTML = `
                <i class="fas fa-circle" style="color: ${color}; font-size: 10px;"></i>
                <span>${message}</span>
            `;
        }

        // ==================== OFFLINE MODE ====================
        function showOfflineModeWarning() {
            const warningElement = document.getElementById('offlineWarning');
            warningElement.style.display = 'block';
            warningElement.innerHTML = `
                <strong><i class="fas fa-exclamation-triangle"></i> Offline Mode</strong>
                <p style="margin: 5px 0 0;">You are currently offline. Some features may be limited.</p>
                <button onclick="retryConnection()" class="btn btn-sm btn-warning" style="margin-top: 8px;">
                    <i class="fas fa-sync-alt"></i> Retry Connection
                </button>
            `;
        }

        async function retryConnection() {
            showMessage('Attempting to reconnect...', 'success');
            
            if (await initializeFirebase()) {
                initializeAdmin();
                showMessage('Reconnected successfully!', 'success');
                document.getElementById('offlineWarning').style.display = 'none';
            } else {
                showMessage('Reconnection failed. Please check your internet connection.', 'error');
            }
        }

        function loadOfflineData() {
            offlineMode = true;
            
            // Update dashboard with offline data
            document.getElementById('totalResults').textContent = 'N/A';
            document.getElementById('withPhotos').textContent = 'N/A';
            document.getElementById('gradeA').textContent = 'N/A';
            document.getElementById('recentAdded').textContent = 'N/A';
            document.getElementById('recordCount').textContent = 'Offline mode - Connect to internet';
            
            // Disable data-dependent buttons
            const dataButtons = document.querySelectorAll('.btn-primary, .btn-success, .btn-info');
            dataButtons.forEach(btn => {
                if (!btn.classList.contains('btn-warning')) {
                    btn.disabled = true;
                    btn.title = "Feature unavailable in offline mode";
                    btn.style.opacity = '0.6';
                    btn.style.cursor = 'not-allowed';
                }
            });
            
            // Show message in recent students
            document.getElementById('recentWithPhotos').innerHTML = `
                <div style="text-align: center; color: #666; padding: 40px;">
                    <i class="fas fa-wifi-slash" style="font-size: 20px; margin-bottom: 10px;"></i>
                    <p>Offline mode - Data unavailable</p>
                </div>
            `;
            
            // Show message in results table
            document.getElementById('resultsTableBody').innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-wifi-slash" style="font-size: 20px; margin-bottom: 10px;"></i>
                        <p>Offline mode - Cannot load results</p>
                        <p style="font-size: 12px;">Please connect to the internet and refresh</p>
                    </td>
                </tr>
            `;
        }

        // ==================== ADMIN PANEL INITIALIZATION ====================
        async function initializeAdmin() {
            if (!isFirebaseInitialized) {
                console.warn('Firebase not initialized, using offline mode');
                loadOfflineData();
                return;
            }
            
            try {
                console.log('Initializing admin panel...');
                
                // Load all data
                await Promise.all([
                    loadDashboardStats(),
                    loadAllResults(),
                    loadStudentsForPhotoUpdate(),
                    loadSettings()
                ]);
                
                showMessage('Admin panel initialized successfully!', 'success');
                
            } catch (error) {
                console.error('Error initializing admin panel:', error);
                showMessage('Error loading data: ' + error.message, 'error');
                
                // Fallback to offline mode
                if (!offlineMode) {
                    loadOfflineData();
                }
            }
        }

        // ==================== SECTION NAVIGATION ====================
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.admin-nav a').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionId + 'Section');
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Set active nav link
            const navLink = document.querySelector(`.admin-nav a[onclick*="${sectionId}"]`);
            if (navLink) navLink.classList.add('active');
            
            // Load section-specific data
            if (offlineMode) return;
            
            switch(sectionId) {
                case 'dashboard':
                    loadDashboardStats();
                    break;
                case 'viewResults':
                    loadAllResults();
                    break;
                case 'profilePictures':
                    loadStudentsForPhotoUpdate();
                    loadStudentsWithoutPhotos();
                    break;
                case 'statistics':
                    loadStatistics();
                    break;
            }
        }

        // ==================== MESSAGE SYSTEM ====================
        function showMessage(text, type = 'success') {
            const messageContainer = document.getElementById('messageContainer');
            const messageId = 'msg-' + Date.now();
            
            const message = document.createElement('div');
            message.id = messageId;
            message.className = `message ${type}`;
            message.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; gap: 10px;">
                    <span style="flex: 1;">${text}</span>
                    <button onclick="document.getElementById('${messageId}').remove()" 
                            style="background: none; border: none; color: inherit; cursor: pointer; font-size: 18px; flex-shrink: 0;">
                        &times;
                    </button>
                </div>
            `;
            
            messageContainer.appendChild(message);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (document.getElementById(messageId)) {
                    document.getElementById(messageId).remove();
                }
            }, 5000);
        }

        function showMessageInContainer(containerId, text, type = 'success') {
            const container = document.getElementById(containerId);
            container.className = `message ${type}`;
            container.innerHTML = text;
            container.style.display = 'block';
        }

        // ==================== DASHBOARD FUNCTIONS ====================
        async function loadDashboardStats() {
            if (!isFirebaseInitialized || offlineMode) return;
            
            try {
                // Get total count
                const totalSnapshot = await db.collection('wimt').get();
                const totalCount = totalSnapshot.size;
                document.getElementById('totalResults').textContent = totalCount;
                document.getElementById('recordCount').textContent = `${totalCount} records in database`;

                // Get students with photos
                const withPhotosSnapshot = await db.collection('wimt')
                    .where('profilePicture', '!=', null)
                    .get();
                document.getElementById('withPhotos').textContent = withPhotosSnapshot.size;

                // Get grade A count
                const gradeASnapshot = await db.collection('wimt').where('grade', '==', 'A').get();
                document.getElementById('gradeA').textContent = gradeASnapshot.size;

                // Get recent additions (this month)
                const startOfMonth = new Date();
                startOfMonth.setDate(1);
                startOfMonth.setHours(0, 0, 0, 0);

                const recentSnapshot = await db.collection('wimt')
                    .where('createdAt', '>=', startOfMonth)
                    .get();

                document.getElementById('recentAdded').textContent = recentSnapshot.size;

                // Load recent students with photos
                loadRecentStudentsWithPhotos();

            } catch (error) {
                console.error('Error loading dashboard stats:', error);
                showMessage('Error loading dashboard statistics', 'error');
            }
        }

        async function loadRecentStudentsWithPhotos() {
            if (!isFirebaseInitialized || offlineMode) return;
            
            try {
                const recentSnapshot = await db.collection('wimt')
                    .where('profilePicture', '!=', null)
                    .orderBy('createdAt', 'desc')
                    .limit(4)
                    .get();

                const container = document.getElementById('recentWithPhotos');
                
                if (recentSnapshot.empty) {
                    container.innerHTML = `
                        <div style="text-align: center; color: #666; padding: 30px;">
                            <i class="fas fa-image" style="font-size: 20px; margin-bottom: 10px; color: #e0e0e0;"></i>
                            <p>No students with profile photos yet</p>
                        </div>
                    `;
                    return;
                }

                const isMobile = window.innerWidth < 768;
                const gridCols = isMobile ? '1fr' : 'repeat(2, 1fr)';
                
                let html = `<div style="display: grid; grid-template-columns: ${gridCols}; gap: 12px;">`;
                
                recentSnapshot.forEach(doc => {
                    const result = doc.data();
                    const initials = getStudentInitials(result.studentName);
                    
                    html += `
                        <div style="display: flex; align-items: center; gap: 10px; padding: 12px; background: white; border-radius: 8px; border: 1px solid #e0e0e0;">
                            <div style="width: 40px; height: 40px; border-radius: 8px; overflow: hidden; flex-shrink: 0;">
                                ${result.profilePicture ? 
                                    `<img src="${result.profilePicture}" alt="${result.studentName}" style="width: 100%; height: 100%; object-fit: cover;">` :
                                    `<div style="width: 100%; height: 100%; background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">${initials}</div>`
                                }
                            </div>
                            <div style="min-width: 0;">
                                <div style="font-weight: 600; color: #1a237e; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${result.studentName || 'Unknown'}</div>
                                <div style="font-size: 11px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${result.enrollmentNumber || ''}</div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;

            } catch (error) {
                console.error('Error loading recent students:', error);
            }
        }

        function refreshDashboard() {
            if (offlineMode) {
                showMessage('Cannot refresh in offline mode', 'error');
                return;
            }
            loadDashboardStats();
            showMessage('Dashboard refreshed', 'success');
        }

        // ==================== RESULTS MANAGEMENT ====================
        async function loadAllResults() {
            if (!isFirebaseInitialized || offlineMode) return;
            
            try {
                const resultsTableBody = document.getElementById('resultsTableBody');
                resultsTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px;">
                            <div style="color: #666;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 20px; margin-bottom: 10px;"></i>
                                <p>Loading results...</p>
                            </div>
                        </td>
                    </tr>
                `;

                const querySnapshot = await db.collection('wimt')
                    .orderBy('createdAt', 'desc')
                    .get();

                allResults = [];
                allStudents = [];
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    allResults.push({
                        id: doc.id,
                        ...data
                    });
                    
                    // For student dropdown
                    allStudents.push({
                        id: doc.id,
                        name: data.studentName,
                        enrollment: data.enrollmentNumber,
                        course: data.course
                    });
                });

                totalResults = allResults.length;
                filteredResults = [...allResults];
                
                displayResultsPage();
                updateTableInfo();

            } catch (error) {
                console.error('Error loading results:', error);
                resultsTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #f44336;">
                            <i class="fas fa-exclamation-circle" style="font-size: 20px; margin-bottom: 10px;"></i>
                            <p>Error loading results</p>
                            <p style="font-size: 12px;">${error.message}</p>
                        </td>
                    </tr>
                `;
                showMessage('Error loading results: ' + error.message, 'error');
            }
        }

        function displayResultsPage() {
            const startIndex = (currentPage - 1) * resultsPerPage;
            const endIndex = startIndex + resultsPerPage;
            const pageResults = filteredResults.slice(startIndex, endIndex);
            
            const resultsTableBody = document.getElementById('resultsTableBody');
            
            if (pageResults.length === 0) {
                resultsTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px;">
                            <div style="color: #666;">
                                <i class="fas fa-inbox" style="font-size: 20px; margin-bottom: 10px;"></i>
                                <p>No results found</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            let tableHTML = '';
            
            pageResults.forEach(result => {
                const gradeClass = `grade-${result.grade?.toLowerCase() || 'a'}`;
                const initials = getStudentInitials(result.studentName);
                const hasPhoto = result.profilePicture ? 'Yes' : 'No';
                const photoStatusClass = result.profilePicture ? 'status-active' : 'status-inactive';
                
                tableHTML += `
                    <tr id="row-${result.id}">
                        <td>
                            <div class="student-cell">
                                <div class="student-avatar">
                                    ${result.profilePicture ? 
                                        `<img src="${result.profilePicture}" alt="${result.studentName}" onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\"student-avatar-placeholder\">${initials}</div>';">` :
                                        `<div class="student-avatar-placeholder">${initials}</div>`
                                    }
                                </div>
                                <div class="student-info">
                                    <div class="student-name">${result.studentName || ''}</div>
                                    <div class="student-enrollment">${result.enrollmentNumber || ''}</div>
                                </div>
                            </div>
                        </td>
                        <td>${result.course || ''}</td>
                        <td>${result.yearOfPassing || ''}</td>
                        <td><span class="status-badge ${gradeClass}">${result.grade || ''}</span></td>
                        <td><span class="status-badge ${result.status === 'active' ? 'status-active' : 'status-inactive'}">${result.status || 'active'}</span></td>
                        <td><span class="status-badge ${photoStatusClass}">${hasPhoto}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-primary" onclick="editResult('${result.id}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteResult('${result.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                                <button class="btn btn-sm btn-info" onclick="managePhoto('${result.id}')">
                                    <i class="fas fa-image"></i> Photo
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            resultsTableBody.innerHTML = tableHTML;
            updatePagination();
        }

        function getStudentInitials(fullName) {
            if (!fullName) return 'ST';
            const names = fullName.split(' ');
            if (names.length >= 2) {
                return (names[0].charAt(0) + names[names.length - 1].charAt(0)).toUpperCase();
            }
            return fullName.substring(0, 2).toUpperCase();
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredResults.length / resultsPerPage);
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            
            document.getElementById('prevBtn').disabled = currentPage <= 1;
            document.getElementById('nextBtn').disabled = currentPage >= totalPages;
        }

        function updateTableInfo() {
            const startIndex = (currentPage - 1) * resultsPerPage + 1;
            const endIndex = Math.min(startIndex + resultsPerPage - 1, filteredResults.length);
            document.getElementById('tableInfo').textContent = 
                `Showing ${filteredResults.length > 0 ? startIndex : 0}-${endIndex} of ${filteredResults.length} results`;
        }

        function nextPage() {
            const totalPages = Math.ceil(filteredResults.length / resultsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayResultsPage();
                updateTableInfo();
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                displayResultsPage();
                updateTableInfo();
            }
        }

        // ==================== ADD NEW RESULT ====================
        async function addNewResult() {
            if (!isFirebaseInitialized || offlineMode) {
                showMessage('Cannot add results in offline mode', 'error');
                return;
            }
            
            const studentName = document.getElementById('addStudentName').value.trim().toUpperCase();
            const enrollment = document.getElementById('addEnrollment').value.trim().toUpperCase();
            const course = document.getElementById('addCourse').value.trim().toUpperCase();
            const year = document.getElementById('addYear').value.trim();
            const grade = document.getElementById('addGrade').value;
            const percentage = document.getElementById('addPercentage').value;
            const remarks = document.getElementById('addRemarks').value.trim();
            const status = document.getElementById('addStatus').value;
            const profilePicture = document.getElementById('addProfileUrl').value.trim() || null;

            // Validation
            if (!studentName || !enrollment || !course || !year || !grade) {
                showMessage('Please fill all required fields (*)', 'error');
                return;
            }

            try {
                // Check if enrollment already exists
                const existingQuery = await db.collection('wimt')
                    .where('enrollmentNumber', '==', enrollment)
                    .limit(1)
                    .get();

                if (!existingQuery.empty) {
                    showMessage('Enrollment number already exists!', 'error');
                    return;
                }

                const resultData = {
                    studentName: studentName,
                    enrollmentNumber: enrollment,
                    course: course,
                    yearOfPassing: year,
                    grade: grade,
                    percentage: percentage || null,
                    remarks: remarks || '',
                    status: status,
                    profilePicture: profilePicture,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Add to Firestore
                await db.collection('wimt').add(resultData);

                // Clear form
                document.getElementById('addStudentName').value = '';
                document.getElementById('addEnrollment').value = '';
                document.getElementById('addCourse').value = '';
                document.getElementById('addYear').value = '';
                document.getElementById('addPercentage').value = '';
                document.getElementById('addRemarks').value = '';
                document.getElementById('addProfileUrl').value = '';
                document.getElementById('addProfilePreview').style.display = 'none';
                document.getElementById('addProfilePlaceholder').style.display = 'flex';

                showMessage('Result added successfully!', 'success');

                // Refresh data
                loadDashboardStats();
                loadAllResults();
                loadStudentsForPhotoUpdate();

                // Auto switch to view results
                setTimeout(() => showSection('viewResults'), 1500);

            } catch (error) {
                console.error('Error adding result:', error);
                showMessage('Error adding result: ' + error.message, 'error');
            }
        }

        function fillSampleData() {
            document.getElementById('addStudentName').value = 'SHWETHA M';
            document.getElementById('addEnrollment').value = 'WIMT2124BTCE00799';
            document.getElementById('addCourse').value = 'BACHELOR OF TECHNOLOGY IN CIVIL ENGINEERING';
            document.getElementById('addYear').value = 'JULY 2021 - JUNE 2024';
            document.getElementById('addGrade').value = 'A';
            document.getElementById('addPercentage').value = '75';
            document.getElementById('addRemarks').value = 'Excellent student with outstanding performance';
            document.getElementById('addProfileUrl').value = 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=150&h=150&fit=crop&crop=face';
            
            // Load the sample image
            loadFromUrl('add');
            
            showMessage('Sample data filled. Click "Save Result" to add it.', 'success');
        }

        // ==================== PROFILE PICTURE MANAGEMENT ====================
        async function loadStudentsForPhotoUpdate() {
            if (!isFirebaseInitialized || offlineMode) return;
            
            try {
                const querySnapshot = await db.collection('wimt')
                    .orderBy('studentName')
                    .get();

                const selectElement = document.getElementById('selectStudent');
                selectElement.innerHTML = '<option value="">-- Select a student --</option>';
                
                querySnapshot.forEach(doc => {
                    const result = doc.data();
                    const displayText = window.innerWidth < 768 
                        ? `${result.studentName.substr(0, 20)}${result.studentName.length > 20 ? '...' : ''} - ${result.enrollmentNumber}`
                        : `${result.studentName} - ${result.enrollmentNumber}`;
                    
                    selectElement.innerHTML += `
                        <option value="${doc.id}">${displayText}</option>
                    `;
                });

            } catch (error) {
                console.error('Error loading students:', error);
                showMessage('Error loading students list', 'error');
            }
        }

        async function loadStudentForPhotoUpdate() {
            const studentId = document.getElementById('selectStudent').value;
            
            if (!studentId) {
                document.getElementById('selectedStudentPreview').style.display = 'none';
                document.getElementById('photoUpdateSection').style.display = 'none';
                return;
            }

            selectedStudentId = studentId;

            try {
                const doc = await db.collection('wimt').doc(studentId).get();
                
                if (!doc.exists) {
                    showMessageInContainer('photoUpdateMessage', 'Student not found!', 'error');
                    return;
                }

                const result = doc.data();
                
                // Update selected student preview
                const displayName = window.innerWidth < 768 && result.studentName.length > 20 
                    ? result.studentName.substr(0, 20) + '...' 
                    : result.studentName;
                
                document.getElementById('selectedStudentName').textContent = displayName || 'Unknown';
                document.getElementById('selectedStudentDetails').textContent = 
                    `${result.enrollmentNumber || ''} • ${result.course || ''}`;
                document.getElementById('currentEnrollment').value = result.enrollmentNumber || '';
                
                // Update profile picture preview
                const photoImg = document.getElementById('selectedStudentPhoto');
                const placeholder = document.getElementById('selectedStudentPlaceholder');
                
                if (result.profilePicture) {
                    photoImg.src = result.profilePicture;
                    photoImg.style.display = 'block';
                    placeholder.style.display = 'none';
                    placeholder.innerHTML = '<i class="fas fa-user"></i>';
                } else {
                    photoImg.style.display = 'none';
                    placeholder.style.display = 'flex';
                    placeholder.innerHTML = getStudentInitials(result.studentName);
                    placeholder.style.fontSize = '20px';
                }
                
                // Update update section preview
                const updateImg = document.getElementById('updateProfilePreview');
                const updatePlaceholder = document.getElementById('updateProfilePlaceholder');
                const updateUrlInput = document.getElementById('updateProfileUrl');
                
                if (result.profilePicture) {
                    updateImg.src = result.profilePicture;
                    updateImg.style.display = 'block';
                    updatePlaceholder.style.display = 'none';
                    updateUrlInput.value = result.profilePicture;
                } else {
                    updateImg.style.display = 'none';
                    updatePlaceholder.style.display = 'flex';
                    updatePlaceholder.innerHTML = '<i class="fas fa-user-graduate"></i>';
                    updateUrlInput.value = '';
                }
                
                // Show sections
                document.getElementById('selectedStudentPreview').style.display = 'block';
                document.getElementById('photoUpdateSection').style.display = 'block';
                document.getElementById('photoUpdateMessage').style.display = 'none';

            } catch (error) {
                console.error('Error loading student:', error);
                showMessageInContainer('photoUpdateMessage', 'Error loading student details', 'error');
            }
        }

        async function updateStudentPhoto() {
            if (!isFirebaseInitialized || offlineMode) {
                showMessageInContainer('photoUpdateMessage', 'Cannot update in offline mode', 'error');
                return;
            }
            
            if (!selectedStudentId) {
                showMessageInContainer('photoUpdateMessage', 'Please select a student first', 'error');
                return;
            }

            const imageUrl = document.getElementById('updateProfileUrl').value.trim();
            const updateImg = document.getElementById('updateProfilePreview');
            
            // If image is loaded in preview but no URL entered, use the preview src
            const finalUrl = imageUrl || (updateImg.style.display !== 'none' ? updateImg.src : null);

            try {
                const updateData = {
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                if (finalUrl) {
                    updateData.profilePicture = finalUrl;
                } else {
                    // If no URL and clear was clicked, remove the profile picture
                    updateData.profilePicture = null;
                }

                await db.collection('wimt').doc(selectedStudentId).update(updateData);

                showMessageInContainer('photoUpdateMessage', 'Profile picture updated successfully!', 'success');
                
                // Refresh data
                loadDashboardStats();
                loadAllResults();
                loadStudentForPhotoUpdate();
                loadStudentsWithoutPhotos();

            } catch (error) {
                console.error('Error updating profile picture:', error);
                showMessageInContainer('photoUpdateMessage', 'Error updating profile picture: ' + error.message, 'error');
            }
        }

        async function removeStudentPhoto() {
            if (!isFirebaseInitialized || offlineMode) {
                showMessageInContainer('photoUpdateMessage', 'Cannot update in offline mode', 'error');
                return;
            }
            
            if (!selectedStudentId) {
                showMessageInContainer('photoUpdateMessage', 'Please select a student first', 'error');
                return;
            }

            if (!confirm('Are you sure you want to remove the profile picture for this student?')) {
                return;
            }

            try {
                await db.collection('wimt').doc(selectedStudentId).update({
                    profilePicture: null,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                showMessageInContainer('photoUpdateMessage', 'Profile picture removed successfully!', 'success');
                
                // Refresh data
                loadDashboardStats();
                loadAllResults();
                loadStudentForPhotoUpdate();
                loadStudentsWithoutPhotos();

            } catch (error) {
                console.error('Error removing profile picture:', error);
                showMessageInContainer('photoUpdateMessage', 'Error removing profile picture', 'error');
            }
        }

        async function loadStudentsWithoutPhotos() {
            if (!isFirebaseInitialized || offlineMode) return;
            
            try {
                const querySnapshot = await db.collection('wimt')
                    .where('profilePicture', '==', null)
                    .orderBy('studentName')
                    .limit(20)
                    .get();

                const container = document.getElementById('studentsWithoutPhotos');
                
                if (querySnapshot.empty) {
                    container.innerHTML = `
                        <div style="text-align: center; color: #666; padding: 30px;">
                            <i class="fas fa-check-circle" style="font-size: 20px; margin-bottom: 10px; color: #4caf50;"></i>
                            <p>All students have profile pictures!</p>
                        </div>
                    `;
                    return;
                }

                const isMobile = window.innerWidth < 768;
                const gridCols = isMobile ? '1fr' : 'repeat(auto-fill, minmax(280px, 1fr))';
                
                let html = `<div style="display: grid; grid-template-columns: ${gridCols}; gap: 12px;">`;
                
                querySnapshot.forEach(doc => {
                    const result = doc.data();
                    const initials = getStudentInitials(result.studentName);
                    const displayName = isMobile && result.studentName.length > 20 
                        ? result.studentName.substr(0, 20) + '...' 
                        : result.studentName;
                    
                    html += `
                        <div style="display: flex; align-items: center; gap: 10px; padding: 12px; background: white; border-radius: 8px; border: 1px solid #e0e0e0;">
                            <div style="width: 40px; height: 40px; border-radius: 8px; background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 16px; flex-shrink: 0;">
                                ${initials}
                            </div>
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-weight: 600; color: #1a237e; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${displayName || 'Unknown'}</div>
                                <div style="font-size: 11px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${result.enrollmentNumber || ''} • ${result.course || ''}</div>
                            </div>
                            <button class="btn btn-sm btn-primary" onclick="selectStudentForPhoto('${doc.id}')">
                                <i class="fas fa-plus"></i> Add Photo
                            </button>
                        </div>
                    `;
                });
                
                html += '</div>';
                
                if (querySnapshot.size > 20) {
                    html += `<div style="text-align: center; margin-top: 12px; color: #666; font-size: 12px;">
                        ... and ${querySnapshot.size - 20} more students without photos
                    </div>`;
                }
                
                container.innerHTML = html;

            } catch (error) {
                console.error('Error loading students without photos:', error);
                container.innerHTML = `
                    <div style="text-align: center; color: #f44336; padding: 30px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 20px; margin-bottom: 10px;"></i>
                        <p>Error loading students without photos</p>
                    </div>
                `;
            }
        }

        function selectStudentForPhoto(studentId) {
            const selectElement = document.getElementById('selectStudent');
            selectElement.value = studentId;
            loadStudentForPhotoUpdate();
            showSection('profilePictures');
            
            // Scroll to update section
            document.getElementById('photoUpdateSection').scrollIntoView({ behavior: 'smooth' });
        }

        // ==================== PROFILE PICTURE MODAL ====================
        function openProfileModal(type) {
            currentModalType = type;
            document.getElementById('profileModal').classList.add('active');
            document.getElementById('urlUploadSection').style.display = 'none';
            document.getElementById('fileUploadSection').style.display = 'none';
            document.getElementById('imagePreviewSection').style.display = 'none';
            currentSelectedImage = null;
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
        }

        function selectUploadMethod(method) {
            if (method === 'url') {
                document.getElementById('urlUploadSection').style.display = 'block';
                document.getElementById('fileUploadSection').style.display = 'none';
                document.getElementById('modalImageUrl').focus();
            } else if (method === 'file') {
                document.getElementById('urlUploadSection').style.display = 'none';
                document.getElementById('fileUploadSection').style.display = 'block';
                document.getElementById('modalImageFile').value = '';
                document.getElementById('filePreview').style.display = 'none';
            }
        }

        function loadImageFromUrl() {
            const url = document.getElementById('modalImageUrl').value.trim();
            
            if (!url) {
                alert('Please enter an image URL');
                return;
            }

            // Validate URL
            if (!url.match(/^https?:\/\/.+\/.+\.(jpg|jpeg|png|gif|webp)(\?.*)?$/i)) {
                alert('Please enter a valid image URL (jpg, png, gif, webp)');
                return;
            }

            currentSelectedImage = url;
            showImagePreview(url);
        }

        function previewImageFile() {
            const fileInput = document.getElementById('modalImageFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select an image file');
                return;
            }

            // Validate file type
            if (!file.type.match('image.*')) {
                alert('Please select an image file (jpg, png, gif)');
                return;
            }

            // Validate file size (2MB max)
            if (file.size > 2 * 1024 * 1024) {
                alert('File size must be less than 2MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('filePreviewImage').src = e.target.result;
                document.getElementById('filePreview').style.display = 'block';
                currentSelectedImage = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function showImagePreview(imageSrc) {
            document.getElementById('finalPreviewImage').src = imageSrc;
            document.getElementById('imagePreviewSection').style.display = 'block';
            document.getElementById('urlUploadSection').style.display = 'none';
            document.getElementById('fileUploadSection').style.display = 'none';
        }

        function saveImageFromUrl() {
            const url = document.getElementById('modalImageUrl').value.trim();
            if (url) {
                currentSelectedImage = url;
                showImagePreview(url);
            }
        }

        function saveImageFromFile() {
            if (currentSelectedImage) {
                showImagePreview(currentSelectedImage);
            }
        }

        function confirmImageSelection() {
            if (!currentSelectedImage) {
                alert('Please select or upload an image first');
                return;
            }

            // Update the appropriate form based on currentModalType
            if (currentModalType === 'add') {
                document.getElementById('addProfilePreview').src = currentSelectedImage;
                document.getElementById('addProfilePreview').style.display = 'block';
                document.getElementById('addProfilePlaceholder').style.display = 'none';
                document.getElementById('addProfileUrl').value = currentSelectedImage;
            } else if (currentModalType === 'update') {
                document.getElementById('updateProfilePreview').src = currentSelectedImage;
                document.getElementById('updateProfilePreview').style.display = 'block';
                document.getElementById('updateProfilePlaceholder').style.display = 'none';
                document.getElementById('updateProfileUrl').value = currentSelectedImage;
            }

            closeProfileModal();
            showMessage('Image selected successfully!', 'success');
        }

        function loadFromUrl(type) {
            let urlInput, previewImg, placeholder;
            
            if (type === 'add') {
                urlInput = document.getElementById('addProfileUrl');
                previewImg = document.getElementById('addProfilePreview');
                placeholder = document.getElementById('addProfilePlaceholder');
            } else if (type === 'update') {
                urlInput = document.getElementById('updateProfileUrl');
                previewImg = document.getElementById('updateProfilePreview');
                placeholder = document.getElementById('updateProfilePlaceholder');
            }
            
            const url = urlInput.value.trim();
            
            if (!url) {
                showMessage('Please enter an image URL', 'error');
                return;
            }

            // Test image load
            const testImage = new Image();
            testImage.onload = function() {
                previewImg.src = url;
                previewImg.style.display = 'block';
                placeholder.style.display = 'none';
                showMessage('Image loaded successfully!', 'success');
            };
            testImage.onerror = function() {
                showMessage('Error loading image. Please check the URL.', 'error');
            };
            testImage.src = url;
        }

        function clearProfilePicture(type) {
            if (type === 'add') {
                document.getElementById('addProfilePreview').style.display = 'none';
                document.getElementById('addProfilePlaceholder').style.display = 'flex';
                document.getElementById('addProfileUrl').value = '';
            } else if (type === 'update') {
                document.getElementById('updateProfilePreview').style.display = 'none';
                document.getElementById('updateProfilePlaceholder').style.display = 'flex';
                document.getElementById('updateProfileUrl').value = '';
            }
            showMessage('Profile picture cleared', 'success');
        }

        // ==================== EDIT FUNCTIONS ====================
        async function editResult(docId) {
            if (!isFirebaseInitialized || offlineMode) {
                showMessage('Cannot edit in offline mode', 'error');
                return;
            }
            
            try {
                const doc = await db.collection('wimt').doc(docId).get();
                
                if (!doc.exists) {
                    showMessage('Result not found!', 'error');
                    return;
                }

                const result = doc.data();
                currentEditId = docId;

                // Create edit form with profile picture
                const initials = getStudentInitials(result.studentName);
                
                const modalContent = document.getElementById('editModalContent');
                modalContent.innerHTML = `
                    <div class="admin-form">
                        <!-- Profile Picture Preview -->
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div class="profile-preview" style="width: 100px; height: 100px; margin: 0 auto;">
                                ${result.profilePicture ? 
                                    `<img src="${result.profilePicture}" alt="${result.studentName}" style="width: 100%; height: 100%; object-fit: cover;">` :
                                    `<div class="profile-preview-placeholder" style="font-size: 30px;">${initials}</div>`
                                }
                            </div>
                            <button class="btn btn-sm btn-info" onclick="managePhoto('${docId}')" style="margin-top: 10px;">
                                <i class="fas fa-image"></i> Change Photo
                            </button>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Student Name *</label>
                                <input type="text" id="editStudentName" class="form-control" value="${result.studentName || ''}">
                            </div>
                            
                            <div class="form-group">
                                <label>Enrollment Number *</label>
                                <input type="text" id="editEnrollment" class="form-control" value="${result.enrollmentNumber || ''}" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label>Course *</label>
                                <input type="text" id="editCourse" class="form-control" value="${result.course || ''}">
                            </div>
                            
                            <div class="form-group">
                                <label>Year of Passing *</label>
                                <input type="text" id="editYear" class="form-control" value="${result.yearOfPassing || ''}">
                            </div>
                            
                            <div class="form-group">
                                <label>Final Grade *</label>
                                <select id="editGrade" class="form-control">
                                    <option value="A" ${result.grade === 'A' ? 'selected' : ''}>A (≥ 60%)</option>
                                    <option value="B" ${result.grade === 'B' ? 'selected' : ''}>B (≥ 50%)</option>
                                    <option value="C" ${result.grade === 'C' ? 'selected' : ''}>C (≥ 40%)</option>
                                    <option value="D" ${result.grade === 'D' ? 'selected' : ''}>D (Failure)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Percentage Score</label>
                                <input type="number" id="editPercentage" class="form-control" value="${result.percentage || ''}" min="0" max="100" step="0.01">
                            </div>
                            
                            <div class="form-group">
                                <label>Profile Picture URL</label>
                                <input type="text" id="editProfilePicture" class="form-control" value="${result.profilePicture || ''}" placeholder="https://example.com/photo.jpg">
                            </div>
                            
                            <div class="form-group">
                                <label>Remarks</label>
                                <input type="text" id="editRemarks" class="form-control" value="${result.remarks || ''}">
                            </div>
                            
                            <div class="form-group">
                                <label>Status</label>
                                <select id="editStatus" class="form-control">
                                    <option value="active" ${result.status === 'active' ? 'selected' : ''}>Active</option>
                                    <option value="inactive" ${result.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 8px; margin-top: 20px; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="saveEdit()" style="flex: 1;">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                            <button class="btn btn-danger" onclick="deleteResult('${docId}')" style="flex: 1;">
                                <i class="fas fa-trash"></i> Delete Result
                            </button>
                        </div>
                    </div>
                `;

                // Show modal
                document.getElementById('editModal').classList.add('active');

            } catch (error) {
                console.error('Error loading result for edit:', error);
                showMessage('Error loading result: ' + error.message, 'error');
            }
        }

        function managePhoto(docId) {
            // Select the student in the profile pictures section
            const selectElement = document.getElementById('selectStudent');
            selectElement.value = docId;
            
            // Switch to profile pictures section
            showSection('profilePictures');
            loadStudentForPhotoUpdate();
            
            // Close edit modal if open
            closeEditModal();
        }

        async function saveEdit() {
            if (!currentEditId) return;
            
            const studentName = document.getElementById('editStudentName').value.trim().toUpperCase();
            const course = document.getElementById('editCourse').value.trim().toUpperCase();
            const year = document.getElementById('editYear').value.trim();
            const grade = document.getElementById('editGrade').value;
            const percentage = document.getElementById('editPercentage').value;
            const profilePicture = document.getElementById('editProfilePicture').value.trim() || null;
            const remarks = document.getElementById('editRemarks').value.trim();
            const status = document.getElementById('editStatus').value;

            // Validation
            if (!studentName || !course || !year || !grade) {
                showMessage('Please fill all required fields (*)', 'error');
                return;
            }

            try {
                const updateData = {
                    studentName: studentName,
                    course: course,
                    yearOfPassing: year,
                    grade: grade,
                    percentage: percentage || null,
                    profilePicture: profilePicture,
                    remarks: remarks || '',
                    status: status,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                await db.collection('wimt').doc(currentEditId).update(updateData);

                showMessage('Result updated successfully!', 'success');
                closeEditModal();
                
                // Refresh data
                loadDashboardStats();
                loadAllResults();
                loadStudentsForPhotoUpdate();

            } catch (error) {
                console.error('Error updating result:', error);
                showMessage('Error updating result: ' + error.message, 'error');
            }
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
            currentEditId = null;
        }

        // ==================== DELETE FUNCTION ====================
        async function deleteResult(docId) {
            if (!confirm('Are you sure you want to delete this result? This action cannot be undone.')) {
                return;
            }

            if (!isFirebaseInitialized || offlineMode) {
                showMessage('Cannot delete in offline mode', 'error');
                return;
            }

            try {
                await db.collection('wimt').doc(docId).delete();
                
                showMessage('Result deleted successfully!', 'success');
                
                // Refresh data
                loadDashboardStats();
                loadAllResults();
                loadStudentsForPhotoUpdate();
                
                // Close edit modal if open
                closeEditModal();

            } catch (error) {
                console.error('Error deleting result:', error);
                showMessage('Error deleting result: ' + error.message, 'error');
            }
        }

        // ==================== SEARCH FUNCTION ====================
        function searchResults() {
            const searchTerm = document.getElementById('searchResults').value.toLowerCase().trim();
            
            if (!searchTerm) {
                filteredResults = [...allResults];
            } else {
                filteredResults = allResults.filter(result => 
                    (result.studentName && result.studentName.toLowerCase().includes(searchTerm)) ||
                    (result.enrollmentNumber && result.enrollmentNumber.toLowerCase().includes(searchTerm)) ||
                    (result.course && result.course.toLowerCase().includes(searchTerm))
                );
            }
            
            currentPage = 1;
            displayResultsPage();
            updateTableInfo();
        }

        // ==================== OTHER FUNCTIONS ====================
        function exportToCSV() {
            if (offlineMode) {
                showMessage('Cannot export in offline mode', 'error');
                return;
            }
            
            if (allResults.length === 0) {
                showMessage('No data to export', 'error');
                return;
            }

            // Create CSV content
            const headers = ['Name', 'Enrollment', 'Course', 'Year', 'Grade', 'Percentage', 'Profile Picture', 'Status'];
            const csvRows = [headers.join(',')];
            
            allResults.forEach(result => {
                const row = [
                    `"${result.studentName || ''}"`,
                    `"${result.enrollmentNumber || ''}"`,
                    `"${result.course || ''}"`,
                    `"${result.yearOfPassing || ''}"`,
                    `"${result.grade || ''}"`,
                    result.percentage || '',
                    `"${result.profilePicture || ''}"`,
                    `"${result.status || ''}"`
                ];
                csvRows.push(row.join(','));
            });
            
            const csvContent = csvRows.join('\n');
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `wimt_results_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showMessage('CSV exported successfully!', 'success');
        }

        async function loadSettings() {
            // Placeholder for settings loading
        }

        function saveSettings() {
            showMessage('Settings saved successfully!', 'success');
        }

        function openBulkPhotoUpload() {
            showMessage('Bulk upload feature coming soon!', 'success');
        }

        function advancedSearch() {
            showMessage('Advanced search feature coming soon!', 'success');
        }

        function loadStatistics() {
            if (!isFirebaseInitialized || offlineMode) {
                document.getElementById('statisticsContent').innerHTML = `
                    <div style="text-align: center; color: #666; padding: 30px;">
                        <i class="fas fa-wifi-slash" style="font-size: 20px; margin-bottom: 10px;"></i>
                        <p>Statistics unavailable in offline mode</p>
                    </div>
                `;
                return;
            }
            
            document.getElementById('statisticsContent').innerHTML = `
                <div style="text-align: center; color: #666; padding: 30px;">
                    <i class="fas fa-chart-pie" style="font-size: 20px; margin-bottom: 10px;"></i>
                    <p>Statistics feature coming soon!</p>
                </div>
            `;
        }

        // ==================== UTILITY FUNCTIONS ====================
        function deleteSelected() {
            // Implement multi-select deletion if needed
        }

        // Initialize the page
        console.log('Admin panel script loaded');
    </script>
</body>
</html>